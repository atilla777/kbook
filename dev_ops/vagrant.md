##### [Главная страница](../index.md)
##### [DevOps](index.md)
## [Vargant](https://www.docker.com/)
### Основные понятия
* **Box** - базовый образ виртуальной машины на основе которой строится Vagrant проект
* **Vagrantfile** - файл проекта Vagrant  в котором задаются инструкции по созданию виртуальной машины проекта

Box при их установке загружаются из облака [HashiCorp's Vagrant Cloud](https://app.vagrantup.com/boxes/search).

Помимо официального облкак можно использовать любые другие, в том числе и свои, box.

Имя box состоит из 2х частей – имени опубликовавшего его пользователя и непосредственно имени box
```
пользователь\название box
```
Помимо названия у box есть версия.

### Установка
Для работы Vagrant требуется соответствующий гипервизор, таким образом его (например, virtualbox) требуется установить.

Установка самого Vagrant выполняется согласно официальной [документации](https://www.vagrantup.com).
### Создание проекта
```cmd
mkdir проект
cd проект
vagrant init
```

#### Список установленных box
```
vagrant box list
```
#### Установить box
```
vagrant box add
```
#### Удалить вирутальную машину проекта из гипервизора (но оставить скаченный базовый box)
```
vagrant destroy
```
#### Удалить box файл не оставляя скаченный образ
```
vagrant remove
```
#### Подготовить папку нового проекта vagrant
```
mkdir проект
cd проект
```
> Можно использовать существующую папку, например, с Ruby on Rails приложением (не выполнять mkdir).
#### Инициировать vagrant и использовать в качестве базы указанный box

```
vagrant init
```
> Указанная выше команда, как и все команды Vagrant выполняется в папке конкретного проекта Vagrant.

### Конфигурирование **Vagrantfile **
#### Используемый базовый box
```
Vagrant.configure("2") do |config|
    config.vm.box = "hashicorp/precise64"
end
```
#### Развернуть и запустить (в фоновом режиме) виртуальную машину из Vagrant проекта (согласно конфигурации, Vagrantfile) или запустить ранее созданную машину (не выполняя начальных установочных процедур)
```
vagrant up
```
> После разворачивания может потребоваться обновить версии VirtualBox additions (в старом базовом box может быть устаревшая версия).

#### Сохранить состояние и выключить виртуальную машину
```
vagrant suspend
```
#### Выключить виртуальную машину
```
vagrant halt
```
#### Подключиться по SSH к запущенной виртуальной машине из проекта Vagrant
```
vagrant ssh
```
#### Синхронизация файлов хоста и гостевой машины
В запущенном образе папка /vagrant это папка ./vagrant в папке проекта Vagrant.

Всё что находится в этих папках синхронизируется между гостевой виртуальной машиной и хостом гипервизора.

#### Provisioning – автоматическая установка программ в гостевой машине
Выполнить скрипт при разворачивании виртуальной машины
```
config.vm.provision :shell, path: "скрипт.sh"
```
> В данном случае скрипт размещается в папке Vagrant проекта.

#### Выполнить скрипты **Provisioning** (если необходимо, к примеру, внести изменения в скрипте сделанные уже после начального развертывания виртуальной машины)
```
vagrant reload --provision
```
#### Перенаправление портов виртуальной машины
```
config.vm.network :forwarded_port, guest: 80, host: 4567
```
