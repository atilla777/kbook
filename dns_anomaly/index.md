## Выявление туннелей в DNS трафике
### Примеры пакетов UDP с обычным DNS трафиком
##### Обычный DNS запрос
![](ordinar_dns_request.png)
##### Обычный DNS ответ
![](ordinar_dns_response.png)
> Спецификация DNS определена в [RFC 1035](https://www.ietf.org/rfc/rfc1035.txt)

### Основные аномалии в DNS тарфике, свидетельствующие о признаках туннеля
1. Необычные символы в именах поддоменов.
2. Большое количество поддоменов (три и более).
3. Закодированные данные в адресе или ответе (кодировки BASE32, BASE64, BASE128).
4. Поддомены в виде хэшей (MD5, SHA1, SHA256).
5. Большое количество запросов к одному домену.
6. Запросы к Fast Flux домену (за счет использование короткого TTL, домен быстро меняет IP адреса).
7. В ответах к разным поддоменам соответсвует один IP-адрес.
8. Размер ответа большой (опция truncated в DNS пакете).
9. Использование необычых или редких типов запросов (NULL, TXT).
10. Частный адрес в ответе.

### Примеры пакетов UDP с аномальным DNS трафиком
##### Признаки туннеля в DNS запросе (на примере программы для построения туннелей **[iodine](https://github.com/yarrick/iodine)**
![](iodine_initial_request.png)
##### Признаки туннеля в DNS запросе при передаче данных
![](iodine_data_transfer_request.png)
##### Признаки туннеля в DNS ответе при передаче данных
![](iodine_data_transfer_response.png)

> Руководство по детектированию DNS туннелей от [SANS](https://www.sans.org/reading-room/whitepapers/dns/detecting-dns-tunneling-34152)