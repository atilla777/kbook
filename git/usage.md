##### [Git](index.md)
##### [Главная страница](../index.md)
## Основные приемы работы c git
#### Начало работы
Создание рабочего каталога
```bash
mkdir папка
```
Инициализация (создание) репозиторий git в рабочем каталоге
```bash
cd папка
git init
```
или клонирование файлов из уже существующего git репозитория
```bash
git clone путь
```
где путь может быть:
* при наличии ssh доступа
ваш.компьютер:/путь

* при наличии запущенного демона git
git://ваш.компьютер/путь

* из общей сетевой папки –
file:///путь

История комитов
```bash
git hist
```
Связывание удаленной (отслеживаемой) ветки с локальной (что бы не указывать имя удаленных репазитария и ветки при выполнении push и pull)
```bash
git branch -u <удаленный репазиторий>/<удаленная ветка>
```
Настройка синхронизации только текущей локальной ветки (а не всех локальных веток) с удаленным репазитарием при выполнении push (параметр simple)
```bash
git config --global push.default simple
```
Обновление до последней версии ранее клонированных файлов
```bash
git pull
```
Добавление содержимого рабочего каталога в репозиторий (файлов, состояние которых будет отслеживаться)
добавление одного файла и/или индексирование измененных файлов (подготовка их к commit)
```bash
git add file
```
добавление всех файлов в текущей папке
```bash
git add *
```
добавление всех файлов и папок
```bash
git add .
```
добавить все измененные файлы
```bash
git add -u
```
Фиксирование файлов, подготовленных к изменению (проиндексированных)
```bash
git commit –m “описание версии”
```
или вместе с индексацией
```bash
git commit –a –m “описание версии”
```
создаем новую ветку (например для создания новой версии проекта) и переходим на ее использование
```bash
git checkout ветка
```
или создаем ветку и сразу переходим на ее использование
```bash
git checkout -b ветка
```
возвращаемся в старую ветку (например в старую версию проекта master)
```bash
git checkout master
```
Объединяем текущую ветку (например master) и новую ветку
```bash
git merge ветка
```
Удаляем ветку с которой объеденились (если она больше не нужна)
```bash
git branch -d ветка
```
Настройка git
```bash
git config  - -global user.name имя
git config - -global user.email mail
git config --global diff.tool vimdiff
git config --global merge.tool vimdiff
```
Переходы между различными состояниями 
1) неотслеживаемые файлы
1 -> 2
```bash
git add .
```
2) отслеживаемые файлы
2 -> 3
```bash
git add .
```
3) проиндексированные файлы (staged)
3 -> 4
```bash
git commit -m "описание"
```
или сразу с индексацией (2->4) (! так индексируются только новые файлы)
```bash
git commit -am "описание"
```
4) файлы в локальном репазитории (commit)
4 -> 5
```bash
git push
```
5) файлы в удаленном репазитории
5 -> 6
```bash
git pull
```
6) файлы в локальном репазитории
разница между последним commit и рабочей директорией
```bash
git diff
```
или
```bash
git difftool
```
разница между последним commit и проиндексированнами файлами
```bash
git diff --staged
```
Организация веток:
master — текущий релиз (каждый merge с develop и commit после этого - это релиз)
develop - текущая разработка (ответвляется от master)
topic - новая функция (ответвляется от develop)
hotfix-* - исправление ошибок (ответвляется от master вливается в master и develop)
Вариант организации совместной работы:
1. репазиторий клонируется разработчиками
2. вносятся изменения
3. отправляется запрос комитеру на принятие изменений
4. комитер принимает изменения и включает их в основной репазиторий
#### Основные приемы работы
HEAD указывает на текущий commit
HEAD^ указывает на комит перед последним комитом
Отменить непроиндексироанные (соответственно незакоммиченные) изменения:
```bash
git checkout -f
```
или
```
git reset --hard HEAD
```
Отменить последний комит (комит отменится, изменения в рабочей директории останутся в проиндексированном состоянии)
```bash
git reset --soft HEAD^
```
Отменить последний комит (изменения в рабочей директории будут утеряны)
```bash
git reset --hard HEAD^
```
Список веток
```bash
git branch
```
Список удаленных веток
```bash
git branch -r
```
Информация об удаленных ветках
```bash
git  remote show origin
```
Создать новую ветку и перейти на нее
```bash
git checkout -b ветка
```
Объединить текущую ветку с указанной
```bash
git merge ветка
```
Если в обоих объединяемый ветках произошли изменения (commit) для их слияния будет создан новый commit,
если изменений не было, то произойдет Fast Forward  комит, то есть HEAD просто перейдет на последний комит.
Удалить ветку 
```bash
git branch -d ветка
```
Изменить последний комит (изменить примечание к нему)
```bash
git commit --amend -m «примечания»
```
Работа с удалёнными репазиториями
добавить удаленный репазиторий
```bash
git remote add origin https://адресс/<имя репазитория>.git
```
или для использования SSH
```bash
git remote add origin git@github.com:пользователь/репазиторий.git
```
создать удаленный репазиторий на windows сетевом диске
(флаг --bare говорит о том, что депозитарий не будет содержать рабочих файлов)
```bash
git init --bare --share
```
добавить удаленный репазиторий в сетевом диске
```bash
git remote add origin file:///z:/папка
```
просмотреть список удаленных репазиториев
```bash
git remote -v
```
отправить в удаленный репазиторий заданную ветку из локального репазитория
```bash
git push -u <имя удаленного репазитория> <ветка из удаленного репазитория>
```
или
связать локальную ветку и отслеживаемую удаленную
```bash
git branch -u <удаленный репазиторий>/<удаленная ветка>
```
затем выполнить
```bash
git push
```
Скопировать удаленный репазиторий
```bash
git clone https://адресс/<имя репазитория>.git
```
Метки (tags)
Метки используются для ссылок на определенные комиты
С помощью меток можно к примеру отмечать версии релизов
Просмотреть список меток
```bash
git tag
```
Добавить метку
```bash
git tag add имя
```
Удалить метку
```bash
git tag -d имя
```
Перенести метки в удаленный репазиторий
```bash
git push --tags
```
Deatached HEAD - состояние при котором состояние рабочей директории не соответсвует HEAD (после  commit на какой либо предыдущий commit).
Для выхода из такого состояния надо вернуться на текущий commit
```bash
git checkout master
```
Запомнить (спрятатть) состояние текущей рабочей директории в которой есть незакомиченые изменения (например, при необходимости сделать pull до комита новых изменений)
```bash
git stash
```
Восстановить сохраненные (спрятанные) изменения
```bash
git stash apply
```
#### Последовательность действий при создании нового Rails проекта на github (в проекте 2 ветки - master и develop)
```bash
rails new проект
cd проект
git remote add origin git@github.com:пользователь/репазиторий.git
git branch  --set-upstream-to=origin/master master
git checkout -b develop
git push  --set-upstream origin develop
```
### Отмена изменений (ситуация - решение)
В комите был сделан неверный комментарий - улучшить (ammend) комит новым коментарием
```bash
git commit --amend -m '<комментарий>'
```
Комит надо повторить с новыми изменениями - дополнить коммит новыми изменениями
```bash
git add .
git commit --amend
```
Отменить последний комит, оставить все изменения в файлах
```bash
git reset --soft HEAD^
```
Отменить последний комит, уничтожить все изменения в файлах
```bash
git reset --hard HEAD^ 
```
Отменить опубликованый комит
```bash
git revert хэш
git push
```
Был проиндексирован файл котрый не должен войти в коммит - вывести файл из проиндексированных (его изменения не войдут в последующий комит)
```bash
git reset HEAD файл
```
Были сделаны ненужные изменения в отслеживаемом файле - заменить файл в рабочей директории (незакомиченные изменения) на файл из репазитория (версия из последнего комита), то есть отменить изменения сделанные с файлом в рабочей директорией.
```bash
git checkout -- файл
```
или отменить изменения во всех отслеживаемых но не проиндексированных файлах
```bash
git checkout -- .
```
Удалить не отслеживаемые файлы
```bash
git clean -fd
```
где
* -f # force
* -d # не только файлы, но и папки
Отменить непроиндексироанные (соответственно незакоммиченные) изменения:
```bash
git checkout -f
```
или
```
git r

Удалить все изменения в отслеживаемых файлах:
```bash
git reset --hard
```
Удаление файлов (файл будет удален и из файловой системы)
```bash
git rm файл
```
Можно удалить файл средствами ОС, а затем выполнить git rm файл
Если удалено средствами ОС несколько файлов, то можно проиндексировать такие изменения командой
```bash
git add -u
```
Переименование (перемещение файлов)
```bash
git mv файл1 файл2
```
